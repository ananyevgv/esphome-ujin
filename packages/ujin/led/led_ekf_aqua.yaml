#-------------------------------------------
# Add yaml 
#packages:
#  led: !include 
#    file: packages/ujin/led/led_ekf_aqua.yaml
#    vars:
#      led_aqua_pin: GPIO5
# and copy file esphome/packages/lume

#-------------------------------------------
# WIFI
#-------------------------------------------
wifi:
  id: wifi_id

#-------------------------------------------
# LIGHT
#-------------------------------------------   
light:
  - platform: esp32_rmt_led_strip
    rgb_order: GRB
    pin: $led_aqua_pin
    num_leds: 35
    chipset: WS2812
    id: led_ww
#    name: "Светодиоды на мультисенсоре"
  
#-------------------------------------------
# DISPLAY
#-------------------------------------------
display:
  - platform: addressable_light
    id: led_matrix_display
    addressable_light_id: led_ww  # Указываем ID светодиодной матрицы
    width: 7  # Ширина (количество столбцов)
    height: 5  # Высота (количество строк)
    rotation: 0°  # Поворот (0°, 90°, 180°, 270°)
    update_interval: 0.5s  # Частота обновления
    # Кастомный pixel_mapper (Pulse таблица 5x7)
    pixel_mapper: |-
      static const uint8_t led_map[5][7] = {
        {21, 20, 19,  0, 18, 17, 16},  // y=0
        {22, 23, 24,  1, 13, 14, 15},  // y=1
        {27, 26, 25,  2, 12, 11, 10},  // y=2
        {28, 29, 30, 34,  7,  8,  9},  // y=3
        { 3, 31, 32, 33,  6,  5,  4}   // y=4
      };
      return led_map[y][x];          
    lambda: |-
      Color red = Color(0xFF0000);
      Color l_red = Color(0x770000);
      Color blue = Color(0x0000FF);
      Color green = Color(0x00FF00);

      if (id(sound_id).state) {
        static int p = 0;
        switch (p) {
          case 0:
            p++;
            break;
          case 1:
            it.line(2, 2, 2, 2, red);
            it.line(4, 2, 4, 2, red);
            p++;
            break;
          case 2: 
            it.filled_triangle (2, 2, 1, 1, 1, 3, red);
            it.filled_triangle (4, 2, 5, 1, 5, 3, red);
            p++;
            break;
          case 3: 
            it.filled_triangle (2, 2, 0, 0, 0, 4, red);
            it.filled_triangle (4, 2, 6, 0, 6, 4, red);
            p=0;
            break;
        } 
      } else {
        if (!(id(wifi_id).is_connected())) {
          static int wf = 0;
          switch (wf) {
            case 0:
              wf++;
              break;
            case 1:
              it.line(1, 4, 1, 4, green);
              wf++;
              break;
            case 2:
              it.filled_triangle (1, 4, 2, 4, 2, 3, green);      
              wf++;
              break;
            case 3:
              it.filled_triangle (1, 4, 3, 4, 3, 2, green);  
              wf++;
              break;
            case 4:
              it.filled_triangle (1, 4, 4, 4, 4, 1, green);
              wf++;
              break; 
            case 5:
              it.filled_triangle (1, 4, 5, 4, 5, 0, green);
              wf=0;
              break; 
            }  
          } else {
            if (id(valve_state).state == "Открыт") {
              static int wo = 0;
              switch (wo) {
                case 0:
                  wo++;
                  break;
                case 1:
                  it.line(3, 0, 3, 0, blue);
                  wo++;
                  break;
                case 2:
                  it.line(3, 0, 3, 1, blue);
                  wo++;
                  break;
                case 3:
                  it.line(3, 0, 3, 2, blue);
                  wo++;
                  break;
                case 4:
                  it.line(3, 0, 3, 3, blue);
                  wo++;
                  break;
                case 5:
                  it.line(3, 0, 3, 4, blue);
                  wo=0;
                  break;
              }
            } else {
              it.line(1, 0, 5, 4, red);
              it.line(1, 4, 5, 0, red);
            }
          }
        }





 


            
            
            
            